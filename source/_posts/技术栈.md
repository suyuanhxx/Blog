---
title: 技术
date: 2017-01-16 13:20:13
tags:
---
<!--
# 目录
1. [技术栈](#1)
2. [并发多线程，网络IO](#2)
2. [缓存数据库读写](#3)
3. [系统架构](#4)
-->

<h2 id="1">技术栈</h2>  
- java
- mysql(apache dbcp封装的读写分离)
- redis
- mybatis
- RPC(hessian,grpc)
- Spring FrameWork(Spring MVC,Spring Boot)
- Rabbitmq
- Mongodb(mongoose)
- Nodejs(express,promise,callback)
<!--more-->

<h2 id="2">并发多线程，网络IO</h2>     
- 并发编程     
    *场景1：*   
    <p>将用户交易记录转化成用户积分，计算时需要防止并发出现积分计算错误现象</p>
    *场景2：*   
    <p>在推送APP消息推送过程中，总是出现一条消息推送两次推送给用户的现象</p>
    *场景3：*  
    <p>日志打印，同一请求在多台服务器上打印日志（同一行日志）</p>
    *场景4：*
    <p>项目中使用Spring AOP事务不合理，redis缓存也被事务包裹，登录时造成死锁</p>

- IO
  1. 同步与异步
  同步和异步关注的是消息通信机制 (synchronous communication/ asynchronous communication)所谓同步，就是在发出一个*调用*时，在没有得到结果之前，该*调用*就不返回。但是一旦调用返回，就得到返回值了。
  2. 阻塞与非阻塞  
  阻塞和非阻塞关注的是程序在等待调用结果（消息，返回值）时的状态.
  3. HTTP Response Entity多次读取，会抛出视图读取已经关闭的流异常
  4.

<h2 id="3">缓存数据库读写</h2>      
- 缓存Redis   
    1. redis中key的前缀生成策略如下：  
        1. 基础方法：    
        <span>以项目+模块的方式进行分开。项目采用项目名称缩写，模块采用模块的缩写。举例：sdk行为的 SDK为项目缩写，ACTION为模块缩写，中间采用下划线 "_" 分割。则前缀key为 "SDK _ACTION" 。<span>  
        2. 高级方法:    
        <span>对项目进行编码，采用16进展数。比如使用三位，对模块进行编码，比如使用三位。举例：sdk行为的，SDK编码：000，行为模块编码000，则前缀key为000000
    以基础方法命名key</span>    
        `000000`该编码，短小，唯一。能减少内存。只要维护好字典表，就能够快速的查询到对应的项目。为最优的解决办法。（仅供参考）    
    2. 缓存淘汰策略：
    3. Redis发布订阅模式（pub/sub）：
- 数据库Mysql    
    1. 数据库读写分离  
    `Spring AOP`作为切入点控制读库写库   
    使用`org.apache.commons.dbcp.BasicDataSource`数据库连接池
    2. issue -> "The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server"   
    由于数据库回收了连接，而系统的缓冲池不知道，继续使用被回收的连接所致的。

<h2 id="4">系统架构</h2>  
- 微服务架构
spring boot, spring cloud  
- 用户体系
- 常量结构
